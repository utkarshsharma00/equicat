Starting main function...

Dummy Water Molecule Data (including padded conformers if applicable):

Conformer 1:
  Atom 1:
    Scalar: [0.6245085597038269, 0.5044019818305969]
    Vector: [[0.7781528830528259, 0.11066269874572754, 0.3002040386199951], [0.3455125689506531, 0.9889494776725769, 0.6245214343070984]]
  Atom 2:
    Scalar: [0.2613031268119812, 0.5422593355178833]
    Vector: [[0.9409216046333313, 0.9073259234428406, 0.9451208710670471], [0.8152619004249573, 0.41765743494033813, 0.6056395769119263]]
  Atom 3:
    Scalar: [0.011581957340240479, 0.30342406034469604]
    Vector: [[0.8732397556304932, 0.01601940393447876, 0.2418389916419983], [0.7171253561973572, 0.6206660866737366, 0.9196023344993591]]

Conformer 2:
  Atom 1:
    Scalar: [0.8829865455627441, 0.4378448724746704]
    Vector: [[0.8011167645454407, 0.8169716596603394, 0.021960437297821045], [0.7856032848358154, 0.5518077611923218, 0.6602251529693604]]
  Atom 2:
    Scalar: [0.005347192287445068, 0.7373504042625427]
    Vector: [[0.19826096296310425, 0.8495221138000488, 0.40013599395751953], [0.12545764446258545, 0.9643984436988831, 0.3810921311378479]]
  Atom 3:
    Scalar: [0.2565338611602783, 0.1373286247253418]
    Vector: [[0.93949294090271, 0.27910131216049194, 0.38403958082199097], [0.8388817310333252, 0.7165037989616394, 0.4174167513847351]]

Conformer 3:
  Atom 1:
    Scalar: [0.9273191690444946, 0.6950927972793579]
    Vector: [[0.9453296661376953, 0.6010924577713013, 0.009342491626739502], [0.9100098609924316, 0.5791323184967041, 0.48201417922973633]]
  Atom 2:
    Scalar: [0.18360161781311035, 0.5206853151321411]
    Vector: [[0.6996773481369019, 0.5507485270500183, 0.24979168176651], [0.9527559280395508, 0.8182645440101624, 0.906101644039154]]
  Atom 3:
    Scalar: [0.4418296813964844, 0.9879703521728516]
    Vector: [[0.8267287015914917, 0.21046751737594604, 0.06064850091934204], [0.9536597728729248, 0.38582634925842285, 0.4110925793647766]]

Conformer 4:
  Atom 1:
    Scalar: [0.9392995834350586, 0.328172504901886]
    Vector: [[0.17427122592926025, 0.18734794855117798, 0.5521605014801025], [0.9382933974266052, 0.5253088474273682, 0.9804116487503052]]
  Atom 2:
    Scalar: [0.38922256231307983, 0.06827801465988159]
    Vector: [[0.7587572932243347, 0.04409754276275635, 0.6301980018615723], [0.3583828806877136, 0.506401538848877, 0.8552751541137695]]
  Atom 3:
    Scalar: [0.09300732612609863, 0.9941457509994507]
    Vector: [[0.2260676622390747, 0.8836066722869873, 0.4839470386505127], [0.3873099684715271, 0.13711881637573242, 0.6370012164115906]]

Created dummy data for 4 water molecule conformers
Dummy data shape: torch.Size([4, 3, 8])
process_conformer_ensemble input shape: torch.Size([4, 3, 8])
Num conformers: 4, Num atoms: 3, Total dim: 8
Scalar dim: 2, Vector dim: 2

No padding needed. Number of conformers matches or exceeds batch size.
Starting sanity checks...

Running sanity checks with original data:
process_conformer_ensemble input shape: torch.Size([4, 3, 8])
Num conformers: 4, Num atoms: 3, Total dim: 8
Scalar dim: 2, Vector dim: 2

No padding needed. Number of conformers matches or exceeds batch size.

Original Data Embeddings

mean_pooling:
  Conformer 1:
    Scalar: [0.29913121461868286, 0.45002850890159607]
    Vector: [[0.8641047477722168, 0.3446693420410156, 0.4957212507724762], [0.6259666085243225, 0.675757646560669, 0.7165877819061279]]
  Conformer 2:
    Scalar: [0.3816225528717041, 0.4375079572200775]
    Vector: [[0.6462902426719666, 0.6485316753387451, 0.26871201395988464], [0.5833142399787903, 0.7442367076873779, 0.48624467849731445]]
  Conformer 3:
    Scalar: [0.5175834894180298, 0.7345828413963318]
    Vector: [[0.8239119052886963, 0.45410284399986267, 0.10659422725439072], [0.9388085007667542, 0.5944077372550964, 0.5997361540794373]]
  Conformer 4:
    Scalar: [0.47384318709373474, 0.46353209018707275]
    Vector: [[0.3863654136657715, 0.37168407440185547, 0.5554351806640625], [0.5613287091255188, 0.3896097242832184, 0.8242293000221252]]

deep_sets:
  Conformer 1:
    Scalar: [0.11669357120990753, -1.053551435470581]
    Vector: [[-0.1963280886411667, 0.32357215881347656, -0.25265464186668396], [0.15221625566482544, 0.20295453071594238, 0.10462287813425064]]
  Conformer 2:
    Scalar: [0.1172194853425026, -1.0511753559112549]
    Vector: [[-0.18654228746891022, 0.3274714946746826, -0.2401697337627411], [0.16685998439788818, 0.19220201671123505, 0.11048761010169983]]
  Conformer 3:
    Scalar: [0.11717159301042557, -1.0513917207717896]
    Vector: [[-0.19012947380542755, 0.32566002011299133, -0.23873759806156158], [0.16829735040664673, 0.19297075271606445, 0.11276879906654358]]
  Conformer 4:
    Scalar: [0.11741015315055847, -1.050313949584961]
    Vector: [[-0.2024601399898529, 0.3221074044704437, -0.2567380666732788], [0.1458607316017151, 0.20905692875385284, 0.10156122595071793]]

self_attention:
  Conformer 1:
    Scalar: [-0.6638001203536987, -0.2950459122657776]
    Vector: [[-0.31468644738197327, 0.09230061620473862, -0.1330939382314682], [0.10829675942659378, -0.13109713792800903, -0.3695749044418335]]
  Conformer 2:
    Scalar: [-0.6621289849281311, -0.2983889579772949]
    Vector: [[-0.31559374928474426, 0.06591921299695969, -0.14636877179145813], [0.12581202387809753, -0.10592503100633621, -0.3734361231327057]]
  Conformer 3:
    Scalar: [-0.6697149872779846, -0.28321343660354614]
    Vector: [[-0.3152514100074768, 0.07587378472089767, -0.14135974645614624], [0.11920294910669327, -0.1154232919216156, -0.3719791769981384]]
  Conformer 4:
    Scalar: [-0.6666868329048157, -0.2892710566520691]
    Vector: [[-0.3144114017486572, 0.10029803961515427, -0.1290697306394577], [0.10298708081245422, -0.13872796297073364, -0.3684043884277344]]

improved_deep_sets:
  Conformer 1:
    Scalar: [-0.2106170356273651, -0.08137497305870056]
    Vector: [[-0.14114037156105042, 0.17162737250328064, 0.2440054565668106], [0.3013004660606384, 0.30312037467956543, -0.034277185797691345]]
  Conformer 2:
    Scalar: [-0.21062034368515015, -0.08137554675340652]
    Vector: [[-0.1374226063489914, 0.17580965161323547, 0.24798451364040375], [0.3039574921131134, 0.31306153535842896, -0.03790045529603958]]
  Conformer 3:
    Scalar: [-0.21061751246452332, -0.08137506246566772]
    Vector: [[-0.1341644525527954, 0.181094229221344, 0.2496737241744995], [0.3091382384300232, 0.323841392993927, -0.036260008811950684]]
  Conformer 4:
    Scalar: [-0.21062171459197998, -0.08137577772140503]
    Vector: [[-0.14913241565227509, 0.17089763283729553, 0.24108392000198364], [0.30845004320144653, 0.2974926233291626, -0.02098706364631653]]

improved_self_attention:
  Conformer 1:
    Scalar: [-0.06055653467774391, 0.3276609778404236]
    Vector: [[0.24033530056476593, 0.2807590365409851, 0.13740524649620056], [-0.16784588992595673, -0.08946528285741806, 0.15841636061668396]]
  Conformer 2:
    Scalar: [0.0591205358505249, 0.5508527159690857]
    Vector: [[0.3006671071052551, 0.14618472754955292, -0.0028457045555114746], [-0.1304655224084854, 0.06648989766836166, -0.01904987543821335]]
  Conformer 3:
    Scalar: [-0.07564939558506012, 0.29461169242858887]
    Vector: [[0.47025132179260254, 0.14619554579257965, -0.006228625774383545], [-0.03958559036254883, -0.04070000350475311, -0.0556628555059433]]
  Conformer 4:
    Scalar: [-0.10270105302333832, 0.2414991408586502]
    Vector: [[0.28360065817832947, 0.27737852931022644, 0.11172658205032349], [-0.10509714484214783, -0.13416093587875366, 0.07994811236858368]]

Running sanity checks with padded data:
process_conformer_ensemble input shape: torch.Size([4, 3, 8])
Num conformers: 4, Num atoms: 3, Total dim: 8
Scalar dim: 2, Vector dim: 2

No padding needed. Number of conformers matches or exceeds batch size.

Padded Data Embeddings

mean_pooling:
  Conformer 1:
    Scalar: [0.29913121461868286, 0.45002850890159607]
    Vector: [[0.8641047477722168, 0.3446693420410156, 0.4957212507724762], [0.6259666085243225, 0.675757646560669, 0.7165877819061279]]
  Conformer 2:
    Scalar: [0.3816225528717041, 0.4375079572200775]
    Vector: [[0.6462902426719666, 0.6485316753387451, 0.26871201395988464], [0.5833142399787903, 0.7442367076873779, 0.48624467849731445]]
  Conformer 3:
    Scalar: [0.5175834894180298, 0.7345828413963318]
    Vector: [[0.8239119052886963, 0.45410284399986267, 0.10659422725439072], [0.9388085007667542, 0.5944077372550964, 0.5997361540794373]]
  Conformer 4:
    Scalar: [0.47384318709373474, 0.46353209018707275]
    Vector: [[0.3863654136657715, 0.37168407440185547, 0.5554351806640625], [0.5613287091255188, 0.3896097242832184, 0.8242293000221252]]

deep_sets:
  Conformer 1:
    Scalar: [-0.1477850377559662, 0.3157463073730469]
    Vector: [[-0.3212755620479584, -0.27833032608032227, 0.07523900270462036], [-0.38225257396698, 0.3544406294822693, -0.43583768606185913]]
  Conformer 2:
    Scalar: [-0.1477850377559662, 0.3157463073730469]
    Vector: [[-0.3199348449707031, -0.2707061469554901, 0.06309179961681366], [-0.3875831663608551, 0.35563331842422485, -0.42900407314300537]]
  Conformer 3:
    Scalar: [-0.1477850377559662, 0.3157463073730469]
    Vector: [[-0.30795153975486755, -0.27318984270095825, 0.07500849664211273], [-0.388222336769104, 0.3460646867752075, -0.44355297088623047]]
  Conformer 4:
    Scalar: [-0.1477850377559662, 0.3157463073730469]
    Vector: [[-0.30012476444244385, -0.2808440923690796, 0.09395702183246613], [-0.3848229646682739, 0.33820840716362, -0.4597928822040558]]

self_attention:
  Conformer 1:
    Scalar: [0.554750919342041, 0.1757548749446869]
    Vector: [[0.18776863813400269, 0.1607908308506012, -0.11602970957756042], [-0.3625370264053345, -0.020848233252763748, 0.0930841714143753]]
  Conformer 2:
    Scalar: [0.5289474129676819, 0.2034657895565033]
    Vector: [[0.17145828902721405, 0.16286487877368927, -0.1206604465842247], [-0.3647206127643585, -0.03912544250488281, 0.11834117025136948]]
  Conformer 3:
    Scalar: [0.5578323602676392, 0.17244568467140198]
    Vector: [[0.14705276489257812, 0.1944109946489334, -0.1120254397392273], [-0.37921151518821716, -0.02657684125006199, 0.08539435267448425]]
  Conformer 4:
    Scalar: [0.5646418333053589, 0.1651328206062317]
    Vector: [[0.21778686344623566, 0.16241714358329773, -0.11322064697742462], [-0.35079649090766907, -0.008244059979915619, 0.06902499496936798]]

improved_deep_sets:
  Conformer 1:
    Scalar: [-0.349895715713501, -0.16788384318351746]
    Vector: [[-0.4198472499847412, -0.48645901679992676, -0.3176405429840088], [0.43223610520362854, -0.23843814432621002, -0.08289891481399536]]
  Conformer 2:
    Scalar: [-0.3498954474925995, -0.16788408160209656]
    Vector: [[-0.43062394857406616, -0.48717790842056274, -0.3225052058696747], [0.43121176958084106, -0.24454690515995026, -0.08807045221328735]]
  Conformer 3:
    Scalar: [-0.34988218545913696, -0.16789627075195312]
    Vector: [[-0.41265255212783813, -0.47927913069725037, -0.31908929347991943], [0.4305037260055542, -0.24135464429855347, -0.08037999272346497]]
  Conformer 4:
    Scalar: [-0.3498917818069458, -0.16788747906684875]
    Vector: [[-0.42807215452194214, -0.49856099486351013, -0.31839272379875183], [0.4401510953903198, -0.23734843730926514, -0.09234842658042908]]

improved_self_attention:
  Conformer 1:
    Scalar: [-0.17786163091659546, -0.1930256485939026]
    Vector: [[0.22768069803714752, -0.19583868980407715, -0.4294467568397522], [-0.2346552312374115, 0.021249815821647644, -0.1267644166946411]]
  Conformer 2:
    Scalar: [-0.24751558899879456, -0.13456857204437256]
    Vector: [[0.31735730171203613, -0.07055200636386871, -0.40435102581977844], [-0.22179511189460754, 0.013637736439704895, -0.1537659466266632]]
  Conformer 3:
    Scalar: [-0.2994668483734131, -0.09224170446395874]
    Vector: [[0.09230223298072815, 0.0956558957695961, -0.34823060035705566], [-0.17637473344802856, 0.117496058344841, -0.30914485454559326]]
  Conformer 4:
    Scalar: [-0.27828025817871094, -0.10707993805408478]
    Vector: [[0.20228606462478638, -0.2859281897544861, -0.28455036878585815], [-0.16704803705215454, 0.03208419680595398, -0.0954076498746872]]

Comparing original and padded results:

mean_pooling:
  Original scalar shape: torch.Size([4, 2])
  Padded scalar shape: torch.Size([4, 2])
  Original vector shape: torch.Size([4, 2, 3])
  Padded vector shape: torch.Size([4, 2, 3])
  Scalar difference (first 5 elements):
    tensor([[0., 0.],
        [0., 0.],
        [0., 0.],
        [0., 0.]])
  Vector difference (first 5 elements):
    tensor([[[0., 0., 0.],
         [0., 0., 0.]],

        [[0., 0., 0.],
         [0., 0., 0.]],

        [[0., 0., 0.],
         [0., 0., 0.]],

        [[0., 0., 0.],
         [0., 0., 0.]]])

deep_sets:
  Original scalar shape: torch.Size([4, 2])
  Padded scalar shape: torch.Size([4, 2])
  Original vector shape: torch.Size([4, 2, 3])
  Padded vector shape: torch.Size([4, 2, 3])
  Scalar difference (first 5 elements):
    tensor([[-0.2645,  1.3693],
        [-0.2650,  1.3669],
        [-0.2650,  1.3671],
        [-0.2652,  1.3661]], grad_fn=<SliceBackward0>)
  Vector difference (first 5 elements):
    tensor([[[-0.1249, -0.6019,  0.3279],
         [-0.5345,  0.1515, -0.5405]],

        [[-0.1334, -0.5982,  0.3033],
         [-0.5544,  0.1634, -0.5395]],

        [[-0.1178, -0.5988,  0.3137],
         [-0.5565,  0.1531, -0.5563]],

        [[-0.0977, -0.6030,  0.3507],
         [-0.5307,  0.1292, -0.5614]]], grad_fn=<SliceBackward0>)

self_attention:
  Original scalar shape: torch.Size([4, 2])
  Padded scalar shape: torch.Size([4, 2])
  Original vector shape: torch.Size([4, 2, 3])
  Padded vector shape: torch.Size([4, 2, 3])
  Scalar difference (first 5 elements):
    tensor([[1.2186, 0.4708],
        [1.1911, 0.5019],
        [1.2275, 0.4557],
        [1.2313, 0.4544]], grad_fn=<SliceBackward0>)
  Vector difference (first 5 elements):
    tensor([[[ 0.5025,  0.0685,  0.0171],
         [-0.4708,  0.1102,  0.4627]],

        [[ 0.4871,  0.0969,  0.0257],
         [-0.4905,  0.0668,  0.4918]],

        [[ 0.4623,  0.1185,  0.0293],
         [-0.4984,  0.0888,  0.4574]],

        [[ 0.5322,  0.0621,  0.0158],
         [-0.4538,  0.1305,  0.4374]]], grad_fn=<SliceBackward0>)

improved_deep_sets:
  Original scalar shape: torch.Size([4, 2])
  Padded scalar shape: torch.Size([4, 2])
  Original vector shape: torch.Size([4, 2, 3])
  Padded vector shape: torch.Size([4, 2, 3])
  Scalar difference (first 5 elements):
    tensor([[-0.1393, -0.0865],
        [-0.1393, -0.0865],
        [-0.1393, -0.0865],
        [-0.1393, -0.0865]], grad_fn=<SliceBackward0>)
  Vector difference (first 5 elements):
    tensor([[[-0.2787, -0.6581, -0.5616],
         [ 0.1309, -0.5416, -0.0486]],

        [[-0.2932, -0.6630, -0.5705],
         [ 0.1273, -0.5576, -0.0502]],

        [[-0.2785, -0.6604, -0.5688],
         [ 0.1214, -0.5652, -0.0441]],

        [[-0.2789, -0.6695, -0.5595],
         [ 0.1317, -0.5348, -0.0714]]], grad_fn=<SliceBackward0>)

improved_self_attention:
  Original scalar shape: torch.Size([4, 2])
  Padded scalar shape: torch.Size([4, 2])
  Original vector shape: torch.Size([4, 2, 3])
  Padded vector shape: torch.Size([4, 2, 3])
  Scalar difference (first 5 elements):
    tensor([[-0.1173, -0.5207],
        [-0.3066, -0.6854],
        [-0.2238, -0.3869],
        [-0.1756, -0.3486]], grad_fn=<SliceBackward0>)
  Vector difference (first 5 elements):
    tensor([[[-0.0127, -0.4766, -0.5669],
         [-0.0668,  0.1107, -0.2852]],

        [[ 0.0167, -0.2167, -0.4015],
         [-0.0913, -0.0529, -0.1347]],

        [[-0.3779, -0.0505, -0.3420],
         [-0.1368,  0.1582, -0.2535]],

        [[-0.0813, -0.5633, -0.3963],
         [-0.0620,  0.1662, -0.1754]]], grad_fn=<SliceBackward0>)
Sanity checks completed.

Sanity checks completed.
